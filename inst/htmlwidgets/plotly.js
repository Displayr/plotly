!function i(r,o,n){function a(e,t){if(!o[e]){if(!r[e]){var l="function"==typeof require&&require;if(!t&&l)return l(e,!0);if(s)return s(e,!0);throw(l=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",l}l=o[e]={exports:{}},r[e][0].call(l.exports,function(t){return a(r[e][1][t]||t)},l,l.exports,i,r,o,n)}return o[e].exports}for(var s="function"==typeof require&&require,t=0;t<n.length;t++)a(n[t]);return a}({1:[function(t,e,l){"use strict";var i,r=t("./widgetdefinition"),t=(i=r)&&i.__esModule?i:{default:i};HTMLWidgets.widget(t.default)},{"./widgetdefinition":2}],2:[function(t,e,l){"use strict";var i={name:"plotly",type:"output",initialize:function(t,e,l){return{}},resize:function(t,e,l,i){i.autosize&&(e=i.width||e,l=i.height||l,Plotly.relayout(t,{width:e,height:l}))},renderValue:function(n,o,t){var e=o.layout||{};t.width=e.width,t.height=e.height,t.autosize=e.autosize||!0;crosstalk.var("plotlyCrosstalkOpts").set(o.highlight);"undefined"!=typeof window&&(window.PLOTLYENV=window.PLOTLYENV||{},window.PLOTLYENV.BASE_URL=o.base_url,o.highlight.persistent||(window.onmousemove=function(t){t||window.event,t.shiftKey?(o.highlight.persistent=!0,o.highlight.persistentShift=!0):(o.highlight.persistent=!1,o.highlight.persistentShift=!1)}));var a=document.getElementById(n.id);if(HTMLWidgets.addPostRenderHandler(function(){for(var t=document.querySelectorAll(".js-plotly-plot .plotly .modebar"),e=0;e<t.length;e++)t[e].style.zIndex=1}),(o.selectize||o.highlight.dynamic)&&!t.plotly){var l,i=document.createElement("div");if(i.class="plotly-crosstalk-control-panel",i.style="display: flex; flex-wrap: wrap",o.highlight.dynamic&&(l=document.createElement("div"),(g=document.createElement("input")).id=n.id+"-colourpicker",g.placeholder="asdasd",(e=document.createElement("label")).for=g.id,e.innerHTML="Brush color&nbsp;&nbsp;",l.appendChild(e),l.appendChild(g),i.appendChild(l)),o.selectize)for(var r=Object.keys(o.selectize),s=0;s<r.length;s++){var u=document.createElement("div");u.id=r[s],u.style="width: 80%; height: 10%",u.class="form-group crosstalk-input-plotly-highlight";var h=document.createElement("label");h.for=r[s],h.innerHTML=o.selectize[r[s]].group,h.class="control-label";var c=document.createElement("div");(A=document.createElement("select")).multiple=!0,c.appendChild(A),u.appendChild(h),u.appendChild(c),i.appendChild(u)}if(a.parentElement.insertBefore(i,a),o.highlight.dynamic){var p=$("#"+g.id),g=o.highlight.color||[],d={value:g[0],showColour:"both",palette:"limited",allowedCols:g.join(" "),width:"20%",height:"10%"};p.colourpicker({changeDelay:0}),p.colourpicker("settings",d),p.colourpicker("value",d.value);for(var f=o.highlight.ctGroups||[],s=0;s<f.length;s++)crosstalk.group(f[s]).var("plotlySelectionColour").set(p.colourpicker("value"));p.on("change",function(){for(var t=0;t<f.length;t++)crosstalk.group(f[t]).var("plotlySelectionColour").set(p.colourpicker("value"))})}}function y(t){return void 0!==t&&t.hasOwnProperty("points")?t.points.map(function(t){var e={curveNumber:t.curveNumber,pointNumber:t.pointNumber,x:t.x,y:t.y};t.hasOwnProperty("z")&&(e.z=t.z),t.hasOwnProperty("customdata")&&(e.customdata=t.customdata);var l,i=document.getElementById(n.id).data[t.curveNumber];l=i._isSimpleKey?(e.key=i.key,[]):["key"];for(var r=0;r<l.length;r++){var o=i[l[r]];Array.isArray(o)&&("number"==typeof t.pointNumber?e[l[r]]=o[t.pointNumber]:Array.isArray(t.pointNumber)?e[l[r]]=o[t.pointNumber[0]][t.pointNumber[1]]:Array.isArray(t.pointNumbers)&&(e[l[r]]=t.pointNumbers.map(function(t){return o[t]})))}return e}):null}t.plotly?(Plotly.purge(a),a.data=void 0,a.layout=void 0,_=Plotly.plot(a,o)):(_=Plotly.plot(a,o),t.plotly=!0),_.then(function(){HTMLWidgets.shinyMode&&Shiny.addCustomMessageHandler("plotly-calls",function(t){var e=document.getElementById(t.id);if(!e)throw new Error("Couldn't find plotly graph with id: "+t.id);if("reconfig"!=t.method){if(!Plotly[t.method])throw new Error("Unknown method "+t.method);var l=[e].concat(t.args);Plotly[t.method].apply(null,l)}else Plotly.react(e,e.data,e.layout,t.args)});for(var t=a._fullLayout._subplots.mapbox||[],e=0;e<t.length;e++){var l=t[e],i=(o.layout[l]||{})._fitBounds||{};i&&a._fullLayout[l]._subplot.map.fitBounds(i.bounds,i.options)}});var v,m,_=function(t){var e=t.data[t.curveNumber];if(!e.legendgroup)return e;var l=t.data.map(function(t){return t.legendgroup}),i=[];for(s=0;s<l.length;s++)l[s]==e.legendgroup&&i.push(t.data[s]);return i};HTMLWidgets.shinyMode&&Shiny.setInputValue&&(v={plotly_deselect:["plotly_selected","plotly_selecting","plotly_brushed","plotly_brushing","plotly_click"],plotly_unhover:["plotly_hover"],plotly_doubleclick:["plotly_click"]},Object.keys(v).map(function(t){a.on(t,function(){v[t].map(function(t){Shiny.setInputValue(t+"-"+o.source,null,{priority:"event"})})})}),m={plotly_click:y,plotly_sunburstclick:y,plotly_hover:y,plotly_unhover:y,plotly_selected:function(t){if(t)return y(t)},plotly_selecting:function(t){if(t)return y(t)},plotly_brushed:function(t){if(t)return t.range||t.lassoPoints},plotly_brushing:function(t){if(t)return t.range||t.lassoPoints},plotly_legendclick:_,plotly_legenddoubleclick:_,plotly_clickannotation:function(t){return t.fullAnnotation}},(o.shinyEvents||[]).map(function(e){var l=m[e]||function(t){return t||n.id};a.on("plotly_brushed"==e?"plotly_selected":"plotly_brushing"==e?"plotly_selecting":e,function(t){Shiny.setInputValue(e+"-"+o.source,JSON.stringify(l(t)),{priority:"event"})})})),o.highlight.color=o.highlight.color||[],Array.isArray(o.highlight.color)||(o.highlight.color=[o.highlight.color]);for(var k=new D(a,o.highlight),b=[],S=0;S<o.data.length;S++){var w=o.data[S].set;w&&-1===b.indexOf(w)&&b.push(w)}for(s=0;s<b.length;s++){var O=b[s],x=new crosstalk.SelectionHandle(O);new crosstalk.FilterHandle(O).on("change",function(t){C(n),k.updateFilter(O,t.value)});x.on("change",function(t){"plotly_selected"===o.highlight.on&&o.highlight.persistentShift&&(Array.prototype.diff=function(e){return this.filter(function(t){return e.indexOf(t)<0})},t.value=t.value.diff(t.oldValue));var e=crosstalk.var("plotlySelectionHistory").get()||[],l={receiverID:k.gd.id,plotlySelectionColour:crosstalk.group(O).var("plotlySelectionColour").get()};if(l[O]=t.value,0<e.length)for(var i=JSON.stringify(l),r=0;r<e.length;r++)if(JSON.stringify(e[r])==i)return;o.highlight.persistent?e.push(l):e=[l],crosstalk.var("plotlySelectionHistory").set(e),k.updateSelection(O,t.value),o.selectize&&(o.highlight.persistent&&null!==t.value||E.clear(!0),E.addItems(t.value,!0),E.close())});var N,A,E,P=function(t){if(t){var e,l=function(t){for(var e={},l=0;l<t.length;l++){var i,r=a.data[t[l].curveNumber];r.key&&r.set&&(e[r.set]=e[r.set]||{value:[],_isSimpleKey:r._isSimpleKey},i="number"==typeof(i=t[l].pointNumber)?i:t[l].pointNumbers,i=r._isSimpleKey?r.key:Array.isArray(i)?i.map(function(t){return r.key[t]}):r.key[i],i=r._isNestedKey?[].concat.apply([],i):i,e[r.set].value=e[r.set].value.concat(i))}return e}(t.points);for(e in l)l.hasOwnProperty(e)&&x.set(l[e].value,{sender:n})}};0<o.highlight.debounce&&(P=function(i,r,o){var n;return function(){var t=this,e=arguments,l=o&&!n;clearTimeout(n),n=setTimeout(function(){n=null,o||i.apply(t,e)},r),l&&i.apply(t,e)}}(P,o.highlight.debounce)),a.on(o.highlight.on,P),a.on(o.highlight.off,function(t){C(n),crosstalk.var("plotlySelectionHistory").set(null),x.set(null,{sender:n})}),o.selectize&&(N=Object.keys(o.selectize)[s],P=o.selectize[N].items,d={options:[{value:"",label:"(All)"}].concat(P),searchField:"label",valueField:"value",labelField:"label",maxItems:50},A=$("#"+N).find("select")[0],(E=$(A).selectize(d)[0].selectize).on("change",function(){var e=k.groupSelections[O]||[];if(!o.highlight.persistent){C(n);for(var t=0;t<e.length;t++)E.removeItem(e[t],!0)}var l=E.items.filter(function(t){return e.indexOf(t)<0});0<l.length?k.updateSelection(O,l):(k.updateSelection(O,null),k.updateSelection(O,E.items))}))}}};function D(t,e){this.gd=t,this.origData=JSON.parse(JSON.stringify(t.data)),this.origOpacity=[];for(var l=0;l<this.origData.length;l++)this.origOpacity[l]=0===this.origData[l].opacity?0:this.origData[l].opacity||1;this.groupSelections={},this.highlight=e}function y(t){return t._isNestedKey?o:t._isSimpleKey?r:v}function v(t,l){var i=[];return t.forEach(function(t,e){(null===t||0<=l.indexOf(t))&&i.push(e)}),i}function r(t,e){return t.every(function(t){return null===t||0<=e.indexOf(t)})?[0]:[]}function o(t,e){for(var l=[],i=0;i<t.length;i++)t[i].every(function(t){return null===t||0<=e.indexOf(t)})&&l.push(i);return l}function m(i,r){var o={};return Object.keys(i).forEach(function(t){var e,l=i[t];"_"===t.charAt(0)?o[t]=l:"transforms"===t&&Array.isArray(l)?o[t]=l.map(function(t){return m(t,r)}):"colorscale"===t&&Array.isArray(l)?o[t]=l:(e=l,"[object Object]"===Object.prototype.toString.call(e)&&Object.getPrototypeOf(e)===Object.prototype?o[t]=m(l,r):Array.isArray(l)?o[t]=function(t,e){for(var l=[],i=0;i<e.length;i++)l.push(t[e[i]]);return l}(l,r):o[t]=l)}),o}function C(t){for(var e=t.querySelectorAll(".select-outline"),l=0;l<e.length;l++)e[l].remove()}D.prototype.close=function(){},D.prototype.updateFilter=function(t,e){if(null==e)this.gd.data=JSON.parse(JSON.stringify(this.origData));else for(var l=[],i=0;i<this.origData.length;i++){var r,o=this.origData[i];o.key&&o.set===t&&(0<(r=y(o)(o.key,e)).length&&(o._isSimpleKey||(o=m(o,r)),l.push(o)))}this.gd.data=l,Plotly.redraw(this.gd)},D.prototype.updateSelection=function(c,p){if(null!==p&&!Array.isArray(p))throw new Error("Invalid keys argument; null or array expected");var t=this.gd.data.length-this.origData.length;if(null===p||!this.highlight.persistent&&0<t){for(var e=[],l=0;l<this.gd.data.length;l++)this.gd.data[l]._isCrosstalkTrace&&e.push(l);Plotly.deleteTraces(this.gd,e),this.groupSelections[c]=p}else{this.groupSelections[c]=this.groupSelections[c]||[];for(l=0;l<p.length;l++){var i=p[l];this.groupSelections[c].indexOf(i)<0&&this.groupSelections[c].push(i)}}if(null===p)Plotly.restyle(this.gd,{opacity:this.origOpacity});else if(1<=p.length){for(var g=[],r=crosstalk.group(c).var("plotlySelectionColour").get()||this.highlight.color[0],l=0;l<this.origData.length;l++){var o,d=JSON.parse(JSON.stringify(this.gd.data[l]));d.key&&d.set===c&&0<(h=y(d)(d.key,p)).length&&(d._isSimpleKey||(d=m(d,h)),o=this.gd._fullData[l],$.extend(!0,d,this.highlight.selected),o.marker&&(d.marker=d.marker||{},d.marker.color=r||d.marker.color||o.marker.color),o.line&&(d.line=d.line||{},d.line.color=r||d.line.color||o.line.color),o.textfont&&(d.textfont=d.textfont||{},d.textfont.color=r||d.textfont.color||o.textfont.color),o.fillcolor&&(d.fillcolor=r||d.fillcolor||o.fillcolor),d.name=d.name||p.join("<br />"),d.legendgroup=d.legendgroup||p.join("<br />"),d._originalIndex=l,d._newIndex=this.gd._fullData.length+g.length,d._isCrosstalkTrace=!0,g.push(d))}if(0<g.length){Plotly.addTraces(this.gd,g).then(function(t){for(var e=t._transitionData._frameHash,l=t._transitionData._frames||[],i=0;i<l.length;i++){for(var r=[],o=0;o<g.length;o++){var n=g[o];-1<l[i].traces.indexOf(n._originalIndex)&&(r.push(n._newIndex),l[i].traces.push(n._newIndex))}if(0!==r.length){for(var a=0,s=l[i].data.length,o=0;o<s;o++){var u,h=l[i].data[o];h.key&&h.set===c&&(0<(u=y(h)(h.key,p)).length&&(d._isSimpleKey||(h=m(h,u)),(u=t._fullData[r[a]]).marker&&(h.marker=u.marker),u.line&&(h.line=u.line),u.textfont&&(h.textfont=u.textfont),a+=1,l[i].data.push(h)))}e[l[i].name]=l[i]}}});for(var n=[],a=[],s=Object.keys(this.groupSelections),u=this.origData.length,l=0;l<u;l++){var h,f=this.origOpacity[l]||1;f===this.gd._fullData[l].opacity&&1!==this.highlight.opacityDim&&(h=v(s,[this.gd.data[l].set])).length&&(n.push(l),a.push(f*this.highlight.opacityDim))}0<n.length&&(Plotly.restyle(this.gd,{opacity:a},n),Plotly.restyle(this.gd,{selectedpoints:null}))}}},e.exports=i},{}]},{},[1]);
//# sourceMappingURL=plotly.js.map
